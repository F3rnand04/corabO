(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9118],{53319:function(e,s,t){Promise.resolve().then(t.bind(t,38568))},38568:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return E}});var a=t(57437),n=t(2265),r=t(12381),i=t(79820),l=t(17168),d=t(96246),c=t(94589),o=t(75060),u=t(92451),f=t(40340),m=t(47692),x=t(83774),p=t(77877),h=t(30401),v=t(13041),j=t(51817),b=t(44322),N=t(3269),g=t(93448),y=t(23340),w=t(99376),k=t(70061);function C(){let{currentUser:e,logout:s}=(0,k.a)(),t=(0,w.useRouter)();return(0,a.jsx)("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur-sm border-b",children:(0,a.jsx)("div",{className:"container px-4 sm:px-6",children:(0,a.jsxs)("div",{className:"flex h-16 items-center justify-between",children:[(0,a.jsx)(r.z,{variant:"ghost",size:"icon",onClick:()=>t.back(),children:(0,a.jsx)(u.Z,{className:"h-6 w-6"})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(f.Z,{className:"h-6 w-6 text-primary"}),(0,a.jsx)("h1",{className:"text-xl font-bold",children:"Panel de Repartidor"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("p",{className:"text-sm font-semibold hidden sm:inline",children:null==e?void 0:e.name}),(0,a.jsxs)(d.qE,{className:"h-8 w-8",children:[(0,a.jsx)(d.F$,{src:null==e?void 0:e.profileImage}),(0,a.jsx)(d.Q5,{children:null==e?void 0:e.name.charAt(0)})]}),(0,a.jsx)(r.z,{variant:"ghost",size:"icon",onClick:s,children:(0,a.jsx)(m.Z,{className:"h-5 w-5"})})]})]})})})}function R(e){var s,t,l,d,c,o,u,f;let{job:m,onAccept:j,onComplete:b,onNavigate:N,onCall:y}=e,{users:w}=(0,k.a)(),C=w.find(e=>e.id===m.providerId),R=null===(t=m.details.delivery)||void 0===t?void 0:null===(s=t.address)||void 0===s?void 0:s.split(",").map(Number),E=null==C?void 0:null===(d=C.profileSetupData)||void 0===d?void 0:null===(l=d.location)||void 0===l?void 0:l.split(",").map(Number),Z=(0,n.useMemo)(()=>E&&R?(0,g.x)(E[0],E[1],R[0],R[1]):null,[E,R]),z=m.details.deliveryCost?.85*m.details.deliveryCost:0;return(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(i.ll,{className:"text-lg",children:["Entrega de ",null==C?void 0:C.name]}),(0,a.jsxs)("span",{className:"font-bold text-lg",children:["$",z.toFixed(2)]})]}),(0,a.jsxs)(i.SZ,{children:["Para: ",null===(o=m.details.delivery)||void 0===o?void 0:null===(c=o.recipientInfo)||void 0===c?void 0:c.name]})]}),(0,a.jsxs)(i.aY,{className:"space-y-3 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(x.Z,{className:"w-4 h-4 mt-1 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold",children:"Recoger en:"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:null==C?void 0:null===(u=C.profileSetupData)||void 0===u?void 0:u.location})]})]}),(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4 mt-1 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold",children:"Entregar en:"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:null===(f=m.details.delivery)||void 0===f?void 0:f.address})]})]}),Z&&(0,a.jsxs)("p",{className:"text-xs font-semibold text-center",children:["Distancia Total: ",Z.toFixed(1)," km"]})]}),(0,a.jsxs)(i.eW,{className:"flex gap-2",children:["Buscando Repartidor"===m.status&&(0,a.jsxs)(r.z,{className:"w-full",onClick:j,children:[(0,a.jsx)(h.Z,{className:"mr-2 h-4 w-4"})," Aceptar Trabajo"]}),"En Reparto"===m.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(r.z,{variant:"outline",className:"flex-1",onClick:()=>{var e,s;return y((null===(s=m.details.delivery)||void 0===s?void 0:null===(e=s.recipientInfo)||void 0===e?void 0:e.phone)||"")},children:[(0,a.jsx)(v.Z,{className:"mr-2 h-4 w-4"})," Llamar"]}),(0,a.jsxs)(r.z,{variant:"outline",className:"flex-1",onClick:()=>N(R[0],R[1]),children:[(0,a.jsx)(p.Z,{className:"mr-2 h-4 w-4"})," Navegar"]}),(0,a.jsx)(r.z,{className:"flex-1",onClick:b,children:"Completar"})]})]})]})}function E(){let{currentUser:e,transactions:s}=(0,k.a)(),[t,r]=(0,n.useState)([]),[d,u]=(0,n.useState)(!0),{toast:f}=(0,y.pm)();(0,n.useEffect)(()=>{if(!e||!e.isGpsActive){u(!1),r([]);return}let s=setInterval(()=>{(0,b.S4)(e.id).then(e=>{r(e)}).finally(()=>u(!1))},5e3);return()=>clearInterval(s)},[e,null==e?void 0:e.isGpsActive]);let m=async s=>{if(e)try{await (0,b.Pz)(s,e.id),f({title:"\xa1Trabajo Aceptado!",description:"El cliente ha sido notificado."})}catch(e){f({variant:"destructive",title:"Error",description:"No se pudo aceptar el trabajo."})}},x=async e=>{try{await (0,b.e5)(e),f({title:"\xa1Entrega Completada!",description:"La transacci\xf3n ha sido actualizada."})}catch(e){f({variant:"destructive",title:"Error",description:"No se pudo completar la entrega."})}},p=(e,s)=>{window.open("https://www.google.com/maps/dir/?api=1&destination=".concat(e,",").concat(s),"_blank")},h=e=>{window.location.href="tel:".concat(e)},v=(0,n.useMemo)(()=>s.filter(s=>"En Reparto"===s.status&&s.details.deliveryProviderId===(null==e?void 0:e.id)),[s,e]),g=(0,n.useMemo)(()=>s.filter(s=>"corabo-admin"===s.providerId&&s.clientId===(null==e?void 0:e.id)),[s,e]);return e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C,{}),(0,a.jsxs)("main",{className:"container py-8 max-w-4xl mx-auto space-y-8 pb-24",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{children:"Estado del Repartidor"})}),(0,a.jsxs)(i.aY,{className:"flex items-center justify-between",children:[(0,a.jsx)(o._,{htmlFor:"availability-switch",className:"font-semibold",children:"Disponible para recibir trabajos"}),(0,a.jsx)(c.r,{id:"availability-switch",checked:e.isGpsActive,onCheckedChange:()=>(0,N.M6)(e.id)})]}),!e.isGpsActive&&(0,a.jsx)(i.eW,{children:(0,a.jsx)("p",{className:"text-sm text-destructive",children:"Est\xe1s desconectado. Act\xedvate para ver y recibir nuevas solicitudes de entrega."})})]}),(0,a.jsxs)(l.mQ,{defaultValue:"available",children:[(0,a.jsxs)(l.dr,{className:"grid w-full grid-cols-3",children:[(0,a.jsx)(l.SP,{value:"available",children:"Disponibles"}),(0,a.jsxs)(l.SP,{value:"in-progress",children:["En Curso (",v.length,")"]}),(0,a.jsx)(l.SP,{value:"history",children:"Historial"})]}),(0,a.jsx)(l.nU,{value:"available",className:"mt-4 space-y-4",children:d?(0,a.jsx)("div",{className:"text-center py-10",children:(0,a.jsx)(j.Z,{className:"w-8 h-8 animate-spin mx-auto"})}):t.length>0?t.map(e=>(0,a.jsx)(R,{job:e,onAccept:()=>m(e.id),onComplete:()=>{},onNavigate:p,onCall:h},e.id)):(0,a.jsx)("p",{className:"text-center text-muted-foreground py-10",children:"No hay trabajos disponibles cerca de ti en este momento."})}),(0,a.jsx)(l.nU,{value:"in-progress",className:"mt-4 space-y-4",children:v.length>0?v.map(e=>(0,a.jsx)(R,{job:e,onAccept:()=>{},onComplete:()=>x(e.id),onNavigate:p,onCall:h},e.id)):(0,a.jsx)("p",{className:"text-center text-muted-foreground py-10",children:"No tienes entregas en curso."})}),(0,a.jsx)(l.nU,{value:"history",className:"mt-4 space-y-2",children:g.map(e=>(0,a.jsx)(i.Zb,{children:(0,a.jsxs)(i.aY,{className:"p-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold",children:e.details.system}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:new Date(e.date).toLocaleDateString()})]}),(0,a.jsxs)("p",{className:"font-bold text-green-600",children:["+$",e.amount.toFixed(2)]})]})},e.id))})]})]})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,a.jsx)(j.Z,{className:"w-12 h-12 animate-spin"})})}},96246:function(e,s,t){"use strict";t.d(s,{F$:function(){return d},Q5:function(){return c},qE:function(){return l}});var a=t(57437),n=t(2265),r=t(61146),i=t(93448);let l=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(r.fC,{ref:s,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...n})});l.displayName=r.fC.displayName;let d=n.forwardRef((e,s)=>{let{className:t,src:n,...l}=e;return(0,a.jsx)(r.Ee,{ref:s,src:n||void 0,className:(0,i.cn)("aspect-square h-full w-full",t),...l})});d.displayName=r.Ee.displayName;let c=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(r.NY,{ref:s,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...n})});c.displayName=r.NY.displayName},79820:function(e,s,t){"use strict";t.d(s,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return i},aY:function(){return o},eW:function(){return u},ll:function(){return d}});var a=t(57437),n=t(2265),r=t(93448);let i=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...n})});i.displayName="Card";let l=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",t),...n})});l.displayName="CardHeader";let d=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("h3",{ref:s,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",t),...n})});d.displayName="CardTitle";let c=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("p",{ref:s,className:(0,r.cn)("text-sm text-muted-foreground",t),...n})});c.displayName="CardDescription";let o=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("p-6 pt-0",t),...n})});o.displayName="CardContent";let u=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("flex items-center p-6 pt-0",t),...n})});u.displayName="CardFooter"},75060:function(e,s,t){"use strict";t.d(s,{_:function(){return c}});var a=t(57437),n=t(2265),r=t(6394),i=t(90535),l=t(93448);let d=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(r.f,{ref:s,className:(0,l.cn)(d(),t),...n})});c.displayName=r.f.displayName},94589:function(e,s,t){"use strict";t.d(s,{r:function(){return l}});var a=t(57437),n=t(2265),r=t(50721),i=t(93448);let l=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(r.fC,{className:(0,i.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...n,ref:s,children:(0,a.jsx)(r.bU,{className:(0,i.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});l.displayName=r.fC.displayName},17168:function(e,s,t){"use strict";t.d(s,{SP:function(){return c},dr:function(){return d},mQ:function(){return l},nU:function(){return o}});var a=t(57437),n=t(2265),r=t(20271),i=t(93448);let l=r.fC,d=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(r.aV,{ref:s,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...n})});d.displayName=r.aV.displayName;let c=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(r.xz,{ref:s,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...n})});c.displayName=r.xz.displayName;let o=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(r.VY,{ref:s,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...n})});o.displayName=r.VY.displayName},44322:function(e,s,t){"use strict";t.d(s,{Pz:function(){return i},Ql:function(){return n},S4:function(){return r},e5:function(){return l},jY:function(){return c},nt:function(){return d}}),t(83079);var a=t(12119),n=(0,a.$)("6f4fd6fdabfafb35d4de90c6c9f78daac42fdb0b"),r=(0,a.$)("1de1b9f86f7a994eadec21ebf86eec4102a17987"),i=(0,a.$)("ac0ea4208717bfc613e9025d88ba6aaded750086"),l=(0,a.$)("9474bc947e5f04b96d7e3e85586064a49fa1ba39"),d=(0,a.$)("7edf0eccac857ad0203221242ddd102790570a06"),c=(0,a.$)("60bff9d42aaa498b8b66134d44b8a07bf56199c0")}},function(e){e.O(0,[3609,9015,2522,2939,6195,8948,3024,803,2971,2117,1744],function(){return e(e.s=53319)}),_N_E=e.O()}]);