"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2092],{16717:function(e,s,r){r.d(s,{P:function(){return x}});var a=r(57437),t=r(70061),n=r(2265),i=r(12381),l=r(31593),d=r(79820),c=r(96246),o=r(69174);function u(e){let{onCheckoutClick:s}=e,{cart:r,users:u,setActiveCartForCheckout:x,currentUser:m}=(0,t.a)(),h=(0,n.useMemo)(()=>r.reduce((e,s)=>{let r=s.product.providerId;return e[r]||(e[r]={provider:u.find(e=>e.id===r),items:[],subtotal:0,itemCount:0}),e[r].items.push(s),e[r].subtotal+=s.product.price*s.quantity,e[r].itemCount+=s.quantity,e},{}),[r,u]),p=r.reduce((e,s)=>e+s.product.price*s.quantity,0),f=e=>{x(e.items),s()};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-3 pr-2",children:Object.values(h).map(e=>{var s;let{provider:r,items:t,subtotal:n,itemCount:l}=e;return(0,a.jsx)(d.Zb,{className:"p-3 relative group/provider-cart",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 overflow-hidden",children:[(0,a.jsxs)(c.qE,{className:"h-8 w-8",children:[(0,a.jsx)(c.F$,{src:null==r?void 0:r.profileImage}),(0,a.jsx)(c.Q5,{children:null==r?void 0:null===(s=r.name)||void 0===s?void 0:s.charAt(0)})]}),(0,a.jsxs)("div",{className:"overflow-hidden",children:[(0,a.jsx)("p",{className:"font-semibold text-sm truncate",children:null==r?void 0:r.name}),(0,a.jsxs)(o.C,{variant:"secondary",className:"text-xs",children:[l," producto(s)"]})]})]}),(0,a.jsxs)("div",{className:"text-right flex-shrink-0",children:[(0,a.jsxs)("p",{className:"font-bold text-sm",children:["$",n.toFixed(2)]}),(0,a.jsx)(i.z,{variant:"link",className:"p-0 h-auto text-xs",onClick:()=>f({items:t}),children:"Ver Prefactura"})]})]})},null==r?void 0:r.id)})}),(0,a.jsx)(l.Z,{}),(0,a.jsxs)("div",{className:"flex justify-between font-bold text-base",children:[(0,a.jsx)("span",{children:"Total Global:"}),(0,a.jsxs)("span",{children:["$",p.toFixed(2)]})]})]})}function x(e){let{onCheckoutClick:s}=e,{cart:r}=(0,t.a)();return(0,a.jsxs)("div",{className:"grid gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium leading-none",children:"Carrito de Compras"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Gestiona tus compras por proveedor."})]}),r.length>0?(0,a.jsx)(u,{onCheckoutClick:s}):(0,a.jsx)("p",{className:"text-sm text-center text-muted-foreground py-4",children:"Tu carrito est\xe1 vac\xedo."})]})}},56710:function(e,s,r){r.d(s,{z:function(){return F}});var a=r(57437),t=r(2265),n=r(70061),i=r(30767),l=r(12381),d=r(31593),c=r(94589),o=r(75060),u=r(21047),x=r(99397),m=r(3609),h=r(60044),p=r(86595),f=r(92369),j=r(13041),v=r(92213),N=r(99376),b=r(86700),g=r(74291),y=r(40279),w=r(33145),k=r(90641),C=r(22299),_=r(89269);function F(e){var s,r,F,z;let{onOpenChange:S}=e,{currentUser:P,users:Z,deliveryAddress:$,setDeliveryAddressToCurrent:E,tempRecipientInfo:q,setTempRecipientInfo:M,activeCartForCheckout:R,setActiveCartForCheckout:T}=(0,n.a)(),I=(0,N.useRouter)(),L=(0,N.useSearchParams)(),[V,O]=(0,t.useState)(()=>q?"other_address":"home"),[Y,A]=(0,t.useState)(!1),[D,G]=(0,t.useState)((null==q?void 0:q.name)||""),[U,J]=(0,t.useState)((null==q?void 0:q.phone)||""),[Q,H]=(0,t.useState)(!1);if((0,t.useEffect)(()=>{if(L.get("fromMap")&&R){S(!0),q&&O("other_address");let e=new URL(window.location.href);e.searchParams.delete("fromMap"),I.replace(e.toString(),{scroll:!1})}},[L,S,q,I,R]),!P||!R)return(0,a.jsxs)(i._T,{children:[(0,a.jsxs)(i.fY,{children:[(0,a.jsx)(i.f$,{children:"Error"}),(0,a.jsx)(i.yT,{children:"No se pudo encontrar el carrito. Por favor, intenta de nuevo."})]}),(0,a.jsx)(i.xo,{children:(0,a.jsx)(i.le,{onClick:()=>{S(!1),T(null)},children:"Cerrar"})})]});let K=null===(s=R[0])||void 0===s?void 0:s.product.providerId;if(!K)return null;let B=Z.find(e=>e.id===K);if(!B)return null;let W=async()=>{P.id&&R&&K&&(await (0,C.JE)(P.id,K,V,Y,q,$),S(!1),A(!1),M(null),T(null))},X=(null===(r=B.profileSetupData)||void 0===r?void 0:r.acceptsCredicora)||!1,ee=(null===(F=B.profileSetupData)||void 0===F?void 0:F.hasPhysicalLocation)||!1,es=R.reduce((e,s)=>e+s.product.price*s.quantity,0),er=P.credicoraLevel||1,ea=v.vl[er.toString()],et=P.credicoraLimit||0,en=1-ea.initialPaymentPercentage,ei=Y?Math.min(es*en,et):0,el=es-ei+("pickup"===V?0:1.5),ed=ei>0?ei/ea.installments:0,ec="pickup"!==V&&!$;return(0,a.jsxs)(g.Vq,{open:Q,onOpenChange:H,children:[(0,a.jsxs)(i._T,{className:"sm:max-w-md",children:[(0,a.jsx)(i.fY,{children:(0,a.jsxs)(i.f$,{children:["Confirmar Compra (",B.name,")"]})}),(0,a.jsx)("div",{className:"space-y-4 -mx-6 px-2",children:(0,a.jsx)(k.x,{className:"max-h-48 px-4",children:(0,a.jsx)("div",{className:"space-y-3",children:R.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"relative w-16 h-16 rounded-md overflow-hidden bg-muted flex-shrink-0",children:(0,a.jsx)(w.default,{src:e.product.imageUrl,alt:e.product.name,fill:!0,style:{objectFit:"cover"}})}),(0,a.jsxs)("div",{className:"flex-grow",children:[(0,a.jsx)("p",{className:"text-sm font-semibold line-clamp-1",children:e.product.name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["$",e.product.price.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(l.z,{variant:"outline",size:"icon",className:"h-6 w-6",onClick:()=>(0,_.x)(P.id,e.product.id,e.quantity-1),children:(0,a.jsx)(u.Z,{className:"h-3 w-3"})}),(0,a.jsx)("span",{className:"font-bold text-sm w-4 text-center",children:e.quantity}),(0,a.jsx)(l.z,{variant:"outline",size:"icon",className:"h-6 w-6",onClick:()=>(0,_.x)(P.id,e.product.id,e.quantity+1),children:(0,a.jsx)(x.Z,{className:"h-3 w-3"})})]})]},e.product.id))})})}),(0,a.jsxs)("div",{className:"py-4 space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(o._,{children:"M\xe9todo de Entrega"}),(0,a.jsxs)(b.E,{value:V,onValueChange:e=>{"current_location"===e&&E(),"other_address"===e&&H(!0),O(e)},className:"space-y-2",children:[(0,a.jsxs)(o._,{htmlFor:"delivery-home",className:"flex items-center space-x-2 rounded-lg border p-3 cursor-pointer has-[:checked]:border-primary",children:[(0,a.jsx)(b.m,{value:"home",id:"delivery-home"}),(0,a.jsxs)("div",{className:"flex-grow",children:[(0,a.jsx)("p",{className:"font-semibold",children:"Mi direcci\xf3n guardada"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground font-mono truncate",children:(null===(z=P.profileSetupData)||void 0===z?void 0:z.location)||"Sin direcci\xf3n guardada"})]})]}),(0,a.jsxs)(o._,{htmlFor:"delivery-current",className:"flex items-center space-x-2 rounded-lg border p-3 cursor-pointer has-[:checked]:border-primary",children:[(0,a.jsx)(b.m,{value:"current_location",id:"delivery-current"}),(0,a.jsxs)("p",{className:"font-semibold flex-grow flex items-center gap-2",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4"})," Mi ubicaci\xf3n actual (GPS)"]})]}),(0,a.jsxs)(o._,{htmlFor:"delivery-other",className:"flex items-center space-x-2 rounded-lg border p-3 cursor-pointer has-[:checked]:border-primary",children:[(0,a.jsx)(b.m,{value:"other_address",id:"delivery-other"}),(0,a.jsxs)("div",{className:"flex-grow",children:[(0,a.jsx)("p",{className:"font-semibold",children:"Enviar a otra direcci\xf3n"}),"other_address"===V&&q&&$&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground mt-1 border-l-2 pl-2 border-primary",children:[(0,a.jsxs)("p",{children:["Para: ",(0,a.jsx)("strong",{children:q.name})," (",q.phone,")"]}),(0,a.jsxs)("p",{children:["En: ",(0,a.jsx)("span",{className:"font-mono",children:$})]})]})]})]}),ee&&(0,a.jsxs)(o._,{htmlFor:"delivery-pickup",className:"flex items-center space-x-2 rounded-lg border p-3 cursor-pointer has-[:checked]:border-primary",children:[(0,a.jsx)(b.m,{value:"pickup",id:"delivery-pickup"}),(0,a.jsx)("p",{className:"font-semibold flex-grow",children:"Recoger en tienda"}),(0,a.jsx)(h.Z,{className:"h-4 h-4 text-muted-foreground"})]})]})]}),(0,a.jsx)(d.Z,{}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{children:"Subtotal:"}),(0,a.jsxs)("span",{className:"font-semibold",children:["$",es.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{children:"Costo de env\xedo (aprox):"}),(0,a.jsx)("span",{className:"font-semibold",children:"pickup"===V?"$0.00":"$".concat("1.50")})]}),X&&(0,a.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t mt-2",children:[(0,a.jsxs)(o._,{htmlFor:"credicora-switch",className:"flex items-center gap-2 text-blue-600 font-semibold",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4 fill-current"}),"Pagar con Credicora"]}),(0,a.jsx)(c.r,{id:"credicora-switch",checked:Y,onCheckedChange:A})]}),(0,a.jsx)(d.Z,{}),(0,a.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,a.jsx)("span",{children:"Total a Pagar Hoy:"}),(0,a.jsxs)("span",{children:["$",Y?el.toFixed(2):(es+("pickup"===V?0:1.5)).toFixed(2)]})]}),Y&&ei>0&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground -mt-2 text-right",children:["y ",ea.installments," cuotas de $",ed.toFixed(2)]})]}),(0,a.jsxs)(i.xo,{children:[(0,a.jsx)(i.le,{onClick:()=>{S(!1),T(null)},children:"Cancelar"}),(0,a.jsx)(i.OL,{onClick:W,disabled:ec,children:"Pagar Ahora"})]})]}),(0,a.jsxs)(g.cZ,{children:[(0,a.jsx)(g.fK,{children:(0,a.jsx)(g.$N,{children:"\xbfQui\xe9n recibe el pedido?"})}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(o._,{htmlFor:"recipient-name",className:"flex items-center gap-2",children:[(0,a.jsx)(f.Z,{className:"w-4 h-4"})," Nombre completo"]}),(0,a.jsx)(y.I,{id:"recipient-name",value:D,onChange:e=>G(e.target.value),placeholder:"Nombre y Apellido"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(o._,{htmlFor:"recipient-phone",className:"flex items-center gap-2",children:[(0,a.jsx)(j.Z,{className:"w-4 h-4"})," Tel\xe9fono de contacto"]}),(0,a.jsx)(y.I,{id:"recipient-phone",type:"tel",value:U,onChange:e=>J(e.target.value),placeholder:"Ej: 04121234567"})]})]}),(0,a.jsx)(l.z,{onClick:()=>{D&&U&&(M({name:D,phone:U}),H(!1),S(!1),I.push("/map?fromMap=true"))},disabled:!D||!U,children:"Continuar al Mapa"})]})]})}},12749:function(e,s,r){r.d(s,{J2:function(){return l},xo:function(){return d},yk:function(){return c}});var a=r(57437),t=r(2265),n=r(27312),i=r(93448);let l=n.fC,d=n.xz,c=t.forwardRef((e,s)=>{let{className:r,align:t="center",sideOffset:l=4,...d}=e;return(0,a.jsx)(n.h_,{children:(0,a.jsx)(n.VY,{ref:s,align:t,sideOffset:l,className:(0,i.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...d})})});c.displayName=n.VY.displayName},90641:function(e,s,r){r.d(s,{x:function(){return l}});var a=r(57437),t=r(2265),n=r(43643),i=r(93448);let l=t.forwardRef((e,s)=>{let{className:r,children:t,...l}=e;return(0,a.jsxs)(n.fC,{ref:s,className:(0,i.cn)("relative overflow-hidden",r),...l,children:[(0,a.jsx)(n.l_,{className:"h-full w-full rounded-[inherit]",children:t}),(0,a.jsx)(d,{}),(0,a.jsx)(n.Ns,{})]})});l.displayName=n.fC.displayName;let d=t.forwardRef((e,s)=>{let{className:r,orientation:t="vertical",...l}=e;return(0,a.jsx)(n.gb,{ref:s,orientation:t,className:(0,i.cn)("flex touch-none select-none transition-colors","vertical"===t&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===t&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...l,children:(0,a.jsx)(n.q4,{className:"relative flex-1 rounded-full bg-border"})})});d.displayName=n.gb.displayName},31593:function(e,s,r){r.d(s,{Z:function(){return l}});var a=r(57437),t=r(2265),n=r(55156),i=r(93448);let l=t.forwardRef((e,s)=>{let{className:r,orientation:t="horizontal",decorative:l=!0,...d}=e;return(0,a.jsx)(n.f,{ref:s,decorative:l,orientation:t,className:(0,i.cn)("shrink-0 bg-border","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",r),...d})});l.displayName=n.f.displayName},94589:function(e,s,r){r.d(s,{r:function(){return l}});var a=r(57437),t=r(2265),n=r(50721),i=r(93448);let l=t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)(n.fC,{className:(0,i.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",r),...t,ref:s,children:(0,a.jsx)(n.bU,{className:(0,i.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});l.displayName=n.fC.displayName},89269:function(e,s,r){r.d(s,{x:function(){return a}}),r(83079);var a=(0,r(12119).$)("58916f5aa51f5451dd6608a06048fa71b5001e5a")}}]);