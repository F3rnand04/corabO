(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3546],{95219:function(e,r,t){Promise.resolve().then(t.bind(t,68752))},92451:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(79205).Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},51817:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(79205).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},57072:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(79205).Z)("ScanLine",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]])},15868:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(79205).Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]])},68752:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return x}});var a=t(57437),n=t(2265),c=t(99376),i=t(12381),s=t(51817),o=t(57072),l=t(15868),d=t(92451),u=t(23340),f=t(70061),m=t(40279),b=t(79820),p=t(84075);function h(){let e=(0,c.useRouter)(),{toast:r}=(0,u.pm)(),{currentUser:t,users:h}=(0,f.a)(),[x,v]=(0,n.useState)(!1),[g,w]=(0,n.useState)(""),[N,j]=(0,n.useState)(!0),y=(0,n.useRef)(null),k=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e,t;let a=async()=>{if(y.current&&k.current&&"BarcodeDetector"in window){let e=new window.BarcodeDetector({formats:["qr_code"]});try{let r=await e.detect(y.current);r.length>0&&!x&&C(r[0].rawValue)}catch(e){console.error("Barcode detection failed:",e)}}x||(t=requestAnimationFrame(a))};return(async()=>{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){j(!1);return}try{e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}),y.current&&(y.current.srcObject=e)}catch(e){console.error("Error accessing camera:",e),j(!1),r({variant:"destructive",title:"Error de C\xe1mara",description:"No se pudo acceder a la c\xe1mara. Revisa los permisos."})}})().then(()=>{"BarcodeDetector"in window?t=requestAnimationFrame(a):(console.warn("BarcodeDetector API not supported in this browser."),j(!1))}),()=>{e&&e.getTracks().forEach(e=>e.stop()),t&&cancelAnimationFrame(t)}},[]);let C=async a=>{if(a&&!x&&t){v(!0);try{let n=JSON.parse(a);if(n.providerId){r({title:"\xa1QR Escaneado!",description:"Conectando con el proveedor..."});let a=await (0,p.lB)(t.id,n.providerId,n.cashierBoxId);if(a)e.push("/payment/approval?sessionId=".concat(a));else throw Error("No se pudo iniciar la sesi\xf3n")}}catch(e){console.error(e),r({variant:"destructive",title:"Error de Sesi\xf3n",description:"No se pudo iniciar la sesi\xf3n de pago. Int\xe9ntalo de nuevo."}),v(!1)}}},Z=async e=>{if(e.preventDefault(),g.trim()&&!x){let e=h.find(e=>e.coraboId===g.trim());e?C(JSON.stringify({providerId:e.id})):r({variant:"destructive",title:"C\xf3digo Inv\xe1lido",description:"No se encontr\xf3 ning\xfan proveedor con ese Corabo ID."})}};return(0,a.jsxs)("div",{className:"relative h-screen w-screen bg-muted/40",children:[(0,a.jsx)("header",{className:"absolute top-0 left-0 z-20 p-4",children:(0,a.jsx)(i.z,{variant:"ghost",size:"icon",onClick:()=>e.back(),className:"bg-background/80 rounded-full shadow-md hover:bg-background",children:(0,a.jsx)(d.Z,{className:"h-6 w-6"})})}),(0,a.jsx)("main",{className:"h-full w-full flex items-center justify-center p-8",children:x?(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4 text-center",children:[(0,a.jsx)(s.Z,{className:"w-16 h-16 animate-spin text-primary"}),(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Iniciando Sesi\xf3n Segura..."})]}):N?(0,a.jsxs)("div",{className:"w-full max-w-sm aspect-square relative rounded-2xl overflow-hidden shadow-2xl border-4 border-white/50",children:[(0,a.jsx)("video",{ref:y,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)(o.Z,{className:"w-2/3 h-2/3 text-white/50 animate-pulse"})}),(0,a.jsx)("p",{className:"absolute bottom-4 left-4 right-4 text-white text-center font-bold text-sm bg-black/50 p-2 rounded-lg",children:"Apunta la c\xe1mara al c\xf3digo QR"})]}):(0,a.jsx)("div",{className:"w-full max-w-sm text-center",children:(0,a.jsxs)(b.Zb,{className:"text-foreground shadow-2xl border-border",children:[(0,a.jsxs)(b.Ol,{children:[(0,a.jsx)("div",{className:"mx-auto bg-primary/10 text-primary w-16 h-16 rounded-full flex items-center justify-center mb-4",children:(0,a.jsx)(l.Z,{className:"w-8 h-8"})}),(0,a.jsx)(b.ll,{children:"Entrada Manual"}),(0,a.jsx)(b.SZ,{children:"La c\xe1mara no est\xe1 disponible. Introduce el Corabo ID del proveedor para iniciar el pago."})]}),(0,a.jsx)(b.aY,{children:(0,a.jsxs)("form",{onSubmit:Z,children:[(0,a.jsx)(m.I,{placeholder:"Ej: corabo1234",value:g,onChange:e=>w(e.target.value),className:"text-center text-lg"}),(0,a.jsx)(i.z,{type:"submit",className:"w-full mt-4",children:"Continuar"})]})})]})})})]})}function x(){return(0,a.jsx)(n.Suspense,{fallback:(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)(s.Z,{className:"w-8 h-8 animate-spin"})}),children:(0,a.jsx)(h,{})})}},79820:function(e,r,t){"use strict";t.d(r,{Ol:function(){return s},SZ:function(){return l},Zb:function(){return i},aY:function(){return d},eW:function(){return u},ll:function(){return o}});var a=t(57437),n=t(2265),c=t(93448);let i=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,c.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...n})});i.displayName="Card";let s=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,c.cn)("flex flex-col space-y-1.5 p-6",t),...n})});s.displayName="CardHeader";let o=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("h3",{ref:r,className:(0,c.cn)("text-2xl font-semibold leading-none tracking-tight",t),...n})});o.displayName="CardTitle";let l=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("p",{ref:r,className:(0,c.cn)("text-sm text-muted-foreground",t),...n})});l.displayName="CardDescription";let d=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,c.cn)("p-6 pt-0",t),...n})});d.displayName="CardContent";let u=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,c.cn)("flex items-center p-6 pt-0",t),...n})});u.displayName="CardFooter"},40279:function(e,r,t){"use strict";t.d(r,{I:function(){return i}});var a=t(57437),n=t(2265),c=t(93448);let i=n.forwardRef((e,r)=>{let{className:t,type:n,...i}=e;return(0,a.jsx)("input",{type:n,className:(0,c.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...i})});i.displayName="Input"},84075:function(e,r,t){"use strict";t.d(r,{CR:function(){return d},QN:function(){return c},aN:function(){return l},cN:function(){return n},gC:function(){return m},jh:function(){return s},lB:function(){return o},qP:function(){return u},vw:function(){return f},zt:function(){return i}}),t(83079);var a=t(12119);(0,a.$)("eb0d52356ee11f9376b2c1c7178c295e4383267f");var n=(0,a.$)("7c90561350f1049b4ad793330e3266bbb0adc684"),c=(0,a.$)("7203eca9170cafc1e5b07649f82ea83c01c2068a"),i=(0,a.$)("eb917fd604377cea11e2b6633ee56913f9344ded"),s=(0,a.$)("7bdd40e655a37e43e89e4f11e34931e24c504554"),o=(0,a.$)("c899ec5d95a35b6623f72371f706a90fbb31a7b1"),l=(0,a.$)("0cc468c9ec8056445c64fbc57ca071d6ae3aea6e"),d=(0,a.$)("b038f92efd11b5e31689b4157ab42be1125f7d60"),u=(0,a.$)("a35440148a898087a7b4cdbd666092655c0b2bf0"),f=(0,a.$)("9b0750bf92342c4d9f2be99ab846de6dc6883805"),m=(0,a.$)("3092aa836369a6fcbeab8cbd1a0770080dd6f169")}},function(e){e.O(0,[3609,9015,2522,2939,803,2971,2117,1744],function(){return e(e.s=95219)}),_N_E=e.O()}]);