"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[803],{12381:function(t,e,a){a.d(e,{d:function(){return s},z:function(){return d}});var n=a(57437),i=a(2265),r=a(37053),o=a(90535),c=a(93448);let s=(0,o.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=i.forwardRef((t,e)=>{let{className:a,variant:i,size:o,asChild:d=!1,...u}=t,l=d?r.g7:"button";return(0,n.jsx)(l,{className:(0,c.cn)(s({variant:i,size:o,className:a})),ref:e,...u})});d.displayName="Button"},70061:function(t,e,a){a.d(e,{AuthProvider:function(){return h},a:function(){return p}});var n=a(57437),i=a(2265),r=a(82148),o=a(92035),c=a(10027),s=a(23340),d=a(99376),u=a(5978),l=a(3269),f=a(39960);let b=(0,i.createContext)(void 0),p=()=>{let t=(0,i.useContext)(b);if(void 0===t)throw Error("useAuth must be used within an AuthProvider");return t},h=t=>{let{children:e}=t,[a,p]=(0,i.useState)(null),[h,m]=(0,i.useState)(null),[v,g]=(0,i.useState)(!0),{toast:S}=(0,s.pm)(),y=(0,d.useRouter)(),I=(0,d.usePathname)(),[w,E]=(0,i.useState)([]),[T,A]=(0,i.useState)([]),[C,M]=(0,i.useState)([]),[N,O]=(0,i.useState)([]),[x,D]=(0,i.useState)([]),[P,$]=(0,i.useState)([]),[_,k]=(0,i.useState)([]),[R,J]=(0,i.useState)(null),[q,z]=(0,i.useState)(null),[F,U]=(0,i.useState)(null),[V,H]=(0,i.useState)(""),[j,B]=(0,i.useState)(null),[G,W]=(0,i.useState)(""),[Y,L]=(0,i.useState)(null),[X,K]=(0,i.useState)([]);(0,i.useEffect)(()=>{try{let t=localStorage.getItem("coraboSearchHistory");t&&K(JSON.parse(t))}catch(t){}},[]),(0,i.useEffect)(()=>{let t=(0,r.Aj)(o.I8,async t=>{if(p(t),t){let e={uid:t.uid,email:t.email,displayName:t.displayName,photoURL:t.photoURL,emailVerified:t.emailVerified};await (0,c.Ie)(e);let a=(0,u.JU)(o.db,"users",t.uid),n=(0,u.cf)(a,t=>{if(t.exists()){let e=t.data();if(m(e),O(e.cart||[]),e.contacts&&e.contacts.length>0){let t=(0,u.IO)((0,u.hJ)(o.db,"users"),(0,u.ar)("id","in",e.contacts));(0,u.cf)(t,t=>{D(t.docs.map(t=>t.data()))})}else D([])}g(!1)}),i=(0,u.cf)((0,u.hJ)(o.db,"users"),t=>E(t.docs.map(t=>t.data()))),r=(0,u.cf)((0,u.IO)((0,u.hJ)(o.db,"transactions"),(0,u.ar)("participantIds","array-contains",t.uid)),t=>A(t.docs.map(t=>t.data()).sort((t,e)=>new Date(e.date).getTime()-new Date(t.date).getTime()))),s=(0,u.cf)((0,u.IO)((0,u.hJ)(o.db,"notifications"),(0,u.ar)("userId","==",t.uid),(0,u.Xo)("timestamp","desc")),t=>$(t.docs.map(t=>t.data()))),d=(0,u.cf)((0,u.IO)((0,u.hJ)(o.db,"conversations"),(0,u.ar)("participantIds","array-contains",t.uid)),t=>k(t.docs.map(t=>t.data()))),l=(0,u.cf)((0,u.IO)((0,u.hJ)(o.db,"qr_sessions"),(0,u.ar)("participantIds","array-contains",t.uid),(0,u.ar)("status","in",["active","pending"])),t=>J(t.empty?null:t.docs[0].data())),f=(0,u.cf)((0,u.hJ)(o.db,"publications"),t=>M(t.docs.map(t=>t.data())));return()=>{n(),i(),r(),s(),d(),l(),f()}}m(null),g(!1),E([]),A([]),O([]),D([]),$([]),k([]),J(null),M([])});return()=>t()},[]),(0,i.useEffect)(()=>{if(v)return;let t="/login"===I,e=I.startsWith("/profile-setup");h||t?!h||h.isInitialSetupComplete||e?h&&h.isInitialSetupComplete&&(t||e)&&y.push("/"):y.push("/profile-setup"):y.push("/login")},[h,v,I,y]);let Z=(0,i.useCallback)(async()=>{try{await (0,r.w7)(o.I8),await (0,c.Rf)(),y.push("/login")}catch(t){S({variant:"destructive",title:"Error",description:"No se pudo cerrar la sesi\xf3n."})}},[y,S]),Q=(0,i.useCallback)(t=>{var e,a;return null!==(a=null==h?void 0:null===(e=h.contacts)||void 0===e?void 0:e.includes(t))&&void 0!==a&&a},[null==h?void 0:h.contacts]),tt=(0,i.useCallback)(async t=>{if(h)try{var e,a;let n=null!==(a=null===(e=h.contacts)||void 0===e?void 0:e.filter(e=>e!==t))&&void 0!==a?a:[];await (0,l.Nq)(h.id,{contacts:n}),S({title:"Contacto eliminado",description:"El contacto ha sido eliminado de tu lista."})}catch(t){S({variant:"destructive",title:"Error",description:"No se pudo eliminar el contacto."})}},[h,S]),te=(0,i.useCallback)(()=>new Promise((t,e)=>{if(navigator.geolocation)navigator.geolocation.getCurrentPosition(e=>{let a={latitude:e.coords.latitude,longitude:e.coords.longitude};B(a),(null==h?void 0:h.id)&&(0,l.Nq)(h.id,{"profileSetupData.location":"".concat(a.latitude,",").concat(a.longitude)}),t(a)},t=>{S({variant:"destructive",title:"Error de Ubicaci\xf3n",description:"No se pudo obtener tu ubicaci\xf3n. Revisa los permisos."}),e(t)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e5});else{let t=Error("Geolocation is not supported by this browser.");S({variant:"destructive",title:"Error de Ubicaci\xf3n",description:t.message}),e(t)}}),[null==h?void 0:h.id,S]),ta=(0,i.useCallback)(async()=>{if(j){H("".concat(j.latitude,",").concat(j.longitude));return}try{let t=await te();H("".concat(t.latitude,",").concat(t.longitude))}catch(t){}},[j,te]),tn=(0,i.useCallback)((t,e,a)=>{let n=a.filter(e=>(e.clientId===t||e.providerId===t)&&["Pagado","Resuelto"].includes(e.status)),i=n.filter(t=>"provider"===e?t.details.clientRating:t.details.providerRating),r=i.reduce((t,a)=>t+("provider"===e?a.details.clientRating:a.details.providerRating),0),o=i.length>0?r/i.length:5,c=a.filter(e=>(e.clientId===t||e.providerId===t)&&"Sistema"!==e.type).length,s=c>0?n.length/c*100:100,d=a.filter(e=>e.providerId===t&&e.details.paymentSentAt&&e.details.paymentConfirmationDate).map(t=>(0,f._)(new Date(t.details.paymentConfirmationDate),new Date(t.details.paymentSentAt))),u=d.length>0?d.reduce((t,e)=>t+e,0)/d.length:0;return{reputation:isNaN(o)?5:o,effectiveness:isNaN(s)?100:Math.min(s,100),averagePaymentTimeMs:u}},[]),ti=(0,i.useCallback)(t=>t.filter(t=>["Finalizado - Pendiente de Pago","Cita Solicitada"].includes(t.status)).map(t=>({date:new Date(t.date),type:"Finalizado - Pendiente de Pago"===t.status?"payment":"appointment",transactionId:t.id})),[]);return(0,n.jsx)(b.Provider,{value:{firebaseUser:a,currentUser:h,isLoadingAuth:v,logout:Z,setCurrentUser:m,contacts:x,isContact:Q,removeContact:tt,users:w,transactions:T,setTransactions:A,allPublications:C,setAllPublications:M,cart:N,activeCartForCheckout:q,setActiveCartForCheckout:z,tempRecipientInfo:F,setTempRecipientInfo:U,deliveryAddress:V,setDeliveryAddress:H,setDeliveryAddressToCurrent:ta,currentUserLocation:j,getCurrentLocation:te,searchQuery:G,setSearchQuery:W,categoryFilter:Y,setCategoryFilter:L,searchHistory:X,clearSearchHistory:()=>{try{K([]),localStorage.removeItem("coraboSearchHistory")}catch(t){}},addSearchToHistory:t=>{t&&K(e=>{let a=[t,...e.filter(e=>e!==t)].slice(0,10);try{localStorage.setItem("coraboSearchHistory",JSON.stringify(a))}catch(t){}return a})},notifications:P,conversations:_,qrSession:R,getUserMetrics:tn,getAgendaEvents:ti},children:e})}},23340:function(t,e,a){a.d(e,{pm:function(){return f}});var n=a(2265);let i=0,r=new Map,o=t=>{if(r.has(t))return;let e=setTimeout(()=>{r.delete(t),u({type:"REMOVE_TOAST",toastId:t})},5e3);r.set(t,e)},c=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,1)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{let{toastId:a}=e;return a?o(a):t.toasts.forEach(t=>{o(t.id)}),{...t,toasts:t.toasts.map(t=>t.id===a||void 0===a?{...t,open:!1}:t)}}case"REMOVE_TOAST":if(void 0===e.toastId)return{...t,toasts:[]};return{...t,toasts:t.toasts.filter(t=>t.id!==e.toastId)}}},s=[],d={toasts:[]};function u(t){d=c(d,t),s.forEach(t=>{t(d)})}function l(t){let{...e}=t,a=(i=(i+1)%Number.MAX_SAFE_INTEGER).toString(),n=()=>u({type:"DISMISS_TOAST",toastId:a});return u({type:"ADD_TOAST",toast:{...e,id:a,open:!0,onOpenChange:t=>{t||n()}}}),{id:a,dismiss:n,update:t=>u({type:"UPDATE_TOAST",toast:{...t,id:a}})}}function f(){let[t,e]=n.useState(d);return n.useEffect(()=>(s.push(e),()=>{let t=s.indexOf(e);t>-1&&s.splice(t,1)}),[t]),{...t,toast:l,dismiss:t=>u({type:"DISMISS_TOAST",toastId:t})}}},10027:function(t,e,a){a.d(e,{Ie:function(){return r},Rf:function(){return i},y$:function(){return o}}),a(83079);var n=a(12119),i=(0,n.$)("92acb34382b7cc06f4de5ac34a55db761fb52098"),r=(0,n.$)("d3324d6c83f3a3db02622507b4b401ba56959940");(0,n.$)("75f66e5bfcc5802b933cf6bb3a81d2e6fb71f193");var o=(0,n.$)("0fcca1ef621d98be26c0bfcf3d0536b2eafaf90b")},3269:function(t,e,a){a.d(e,{B3:function(){return b},CU:function(){return d},Gh:function(){return l},JM:function(){return s},M6:function(){return c},Nq:function(){return i},Pd:function(){return r},Q8:function(){return f},xb:function(){return u},zz:function(){return o}}),a(83079);var n=a(12119);(0,n.$)("f2adee7cf4f2f8b5b2ceee6347d65222ab445eb7");var i=(0,n.$)("5490e0fd1c242a5eef82e0a3ff2c7cb530d9e533"),r=(0,n.$)("88599a77cbf14a811bcc0d4db954c292e07a6abc"),o=(0,n.$)("86ad7b8d8be30d4d4c2808f5bbf0e5d8e49ba32a"),c=(0,n.$)("d3b29fd6112ff6850dece7a05d126c764332b184");(0,n.$)("9011e4229b8124357687ad18fd8d6620369c6645");var s=(0,n.$)("b6340bdf49ffb4d7a7d472365ccd4c5bb696fb65"),d=(0,n.$)("9dbd3aa17f1b0d765a1019942ecab992f84521ef"),u=(0,n.$)("e86019e14c4860bd9cb7e35ea4e6b273f001c319"),l=(0,n.$)("f1a5672380f0c97ae05054afe728fa52f5b897d1"),f=(0,n.$)("453545b1b78662b98891491ec49e72197e0e6598");(0,n.$)("7f3879fcde338c8e9e9f8b6e19e6e4358bb243bd");var b=(0,n.$)("6a3ff619f9bdd51def8f22d0234148dfd9e9330e")},92035:function(t,e,a){a.d(e,{I8:function(){return s},db:function(){return d},Vv:function(){return l}});var n=a(738),i=a(82148),r=a(5978),o=a(96485);let c=(0,n.C6)().length?(0,n.Mq)():(0,n.ZF)({apiKey:"AIzaSyDYfiqZNb-T1CB4lVe3bPCmpnVH2OWhaLY",authDomain:"127.0.0.1",projectId:"corabo-dc0a9",storageBucket:"corabo-dc0a9.firebasestorage.app",messagingSenderId:"752314666658",appId:"1:752314666658:web:3f1d9f1e15bc942bc2d1fb",measurementId:"G-RY9MYEBX4K"}),s=(0,i.v0)(c),d=(0,r.ad)(c),u=(0,o.cF)(c),l=new i.hJ;if(window.location.hostname.endsWith("cloudworkstations.dev"))try{s.emulatorConfig||(console.log("Connecting to Firebase emulators on host: ".concat(window.location.hostname)),(0,i.S$)(s,"http://".concat(window.location.hostname,":9201")),(0,r.at)(d,window.location.hostname,8183),(0,o.a1)(u,window.location.hostname,9299),console.log("Successfully connected to Firebase emulators."))}catch(t){console.error("Error connecting to Firebase emulators:",t)}},93448:function(t,e,a){a.d(e,{cn:function(){return r},x:function(){return o}});var n=a(61994),i=a(53335);function r(){for(var t=arguments.length,e=Array(t),a=0;a<t;a++)e[a]=arguments[a];return(0,i.m6)((0,n.W)(e))}function o(t,e,a,n){let i=Math.PI/180*(a-t),r=Math.PI/180*(n-e),o=Math.sin(i/2)*Math.sin(i/2)+Math.cos(Math.PI/180*t)*Math.cos(Math.PI/180*a)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6371}}}]);