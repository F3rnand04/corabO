"use strict";exports.id=5180,exports.ids=[5180],exports.modules={69069:(e,a,t)=>{t.d(a,{m:()=>A});var i=t(10326),n=t(17577),s=t(35047),l=t(24118),o=t(91664),r=t(38443),d=t(13511),c=t(52952),m=t(1292),x=t(33734),h=t(15188),b=t(40617),u=t(69436),p=t(86645),f=t(15601),g=t(30361),j=t(50949),v=t(14228),y=t(3289),C=t(69669),N=t(36283),w=t(41190),P=t(82015),Z=t(55296),z=t(94316),S=t(76253),$=t(39642);let D=e=>{let a=`
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; color: #333; }
    .invoice-box { max-width: 800px; margin: auto; padding: 30px; border: 1px solid #eee; box-shadow: 0 0 10px rgba(0, 0, 0, .15); font-size: 16px; line-height: 24px; }
    .invoice-box table { width: 100%; line-height: inherit; text-align: left; }
    .invoice-box table td { padding: 5px; vertical-align: top; }
    .invoice-box table tr td:nth-child(2) { text-align: right; }
    .invoice-box table tr.top table td { padding-bottom: 20px; }
    .invoice-box table tr.top table td.title { font-size: 45px; line-height: 45px; color: #333; }
    .invoice-box table tr.information table td { padding-bottom: 40px; }
    .invoice-box table tr.heading td { background: #eee; border-bottom: 1px solid #ddd; font-weight: bold; }
    .invoice-box table tr.details td { padding-bottom: 20px; }
    .invoice-box table tr.item td{ border-bottom: 1px solid #eee; }
    .invoice-box table tr.item.last td { border-bottom: none; }
    .invoice-box table tr.total td:nth-child(2) { border-top: 2px solid #eee; font-weight: bold; }
    .text-right { text-align: right; }
    .font-mono { font-family: monospace; }
  `,t=e.details.clientName||"N/A",i=e.details.providerName||"Sistema",n=e.details.serviceName||e.details.system||"Servicio/Producto",s=new Date(e.date).toLocaleDateString("es-VE");return`
    <html>
      <head>
        <meta charset="utf-8">
        <style>${a}</style>
      </head>
      <body>
        <div class="invoice-box">
          <table cellpadding="0" cellspacing="0">
            <tr class="top">
              <td colspan="2">
                <table>
                  <tr>
                    <td class="title">
                        Corabo
                    </td>
                    <td>
                      Factura #: ${e.id.substring(0,8)}...<br>
                      Creada: ${s}<br>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
            <tr class="information">
              <td colspan="2">
                <table>
                  <tr>
                    <td>
                      Proveedor:<br>
                      ${i}<br>
                    </td>
                    <td>
                      Cliente:<br>
                      ${t}<br>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
            <tr class="heading">
              <td>Descripci\xf3n</td>
              <td>Precio</td>
            </tr>
            <tr class="item">
              <td>${n}</td>
              <td class="font-mono">$${e.amount.toFixed(2)}</td>
            </tr>
            <tr class="total">
              <td></td>
              <td class="text-right font-mono">Total: $${e.amount.toFixed(2)}</td>
            </tr>
          </table>
        </div>
      </body>
    </html>
  `},I=async e=>{if(0===e.length)return;let a=e[0],t=D(a),i=document.createElement("div");i.style.position="absolute",i.style.left="-9999px",i.innerHTML=t,document.body.appendChild(i);let n=i.querySelector(".invoice-box");if(!n){console.error("Could not find the invoice element to render."),document.body.removeChild(i);return}try{let e=await (0,$.default)(n,{scale:2}),t=e.toDataURL("image/png"),i=new S.ZP("p","pt","a4"),s=i.internal.pageSize.getWidth(),l=i.internal.pageSize.getHeight(),o=e.width,r=e.height,d=o/r,c=s-40,m=c/d;m>l-40&&(c=(m=l-40)*d);let x=(s-c)/2;i.addImage(t,"PNG",x,20,c,m),i.save(`factura-${a.id}.pdf`)}catch(e){console.error("Error generating PDF:",e)}finally{document.body.removeChild(i)}};var k=t(76897);function R({tx:e,onAction:a}){let{currentUser:t}=(0,d.a)(),[s,l]=(0,n.useState)(""),[r,x]=(0,n.useState)(0);if(!t)return null;let h=i=>{t&&((0,z.kQ)({transactionId:e.id,userId:t.id,fromThirdParty:i}),a())};return({"Solicitud Pendiente":(0,i.jsxs)("div",{className:"w-full space-y-2 pt-4 border-t",children:[i.jsx("h4",{className:"font-semibold",children:"Enviar Cotizaci\xf3n"}),i.jsx(P.g,{placeholder:"Desglose de costos y condiciones...",value:s,onChange:e=>l(e.target.value)}),i.jsx(w.I,{type:"number",placeholder:"Monto total",value:r||"",onChange:e=>x(parseFloat(e.target.value))}),i.jsx(o.z,{onClick:()=>{r>0&&s&&((0,z.k)({transactionId:e.id,userId:t.id,breakdown:s,total:r}),a())},className:"w-full",children:"Enviar Cotizaci\xf3n"})]}),"Pago Enviado - Esperando Confirmaci\xf3n":(0,i.jsxs)(Z.aR,{children:[i.jsx(Z.vW,{asChild:!0,children:i.jsx(o.z,{className:"w-full",children:"Confirmar Pago"})}),(0,i.jsxs)(Z._T,{children:[(0,i.jsxs)(Z.fY,{children:[i.jsx(Z.f$,{children:"Confirmar Recepci\xf3n de Pago"}),i.jsx(Z.yT,{children:"Por favor, confirma que has recibido el pago. Si el pago proviene de una cuenta que no pertenece al titular de la cuenta Corabo, por favor rep\xf3rtalo para mantener la seguridad de la comunidad."})]}),(0,i.jsxs)(Z.xo,{className:"gap-2 sm:flex-row-reverse",children:[i.jsx(Z.OL,{onClick:()=>h(!1),children:"Confirmar Pago del Titular"}),i.jsx(o.z,{variant:"destructive",type:"button",onClick:()=>h(!0),children:"Reportar Pago de Tercero"}),i.jsx(Z.le,{className:"mt-2 sm:mt-0",children:"Cancelar"})]})]})]}),"Acuerdo Aceptado - Pendiente de Ejecuci\xf3n":(0,i.jsxs)(o.z,{onClick:()=>{t&&((0,z.qO)({transactionId:e.id,userId:t.id}),a())},className:"w-full",children:[i.jsx(c.Z,{className:"mr-2 h-4 w-4"}),"Marcar como Finalizado"]}),"Cita Solicitada":(0,i.jsxs)(o.z,{onClick:()=>{t&&((0,z.tY)({transactionId:e.id,userId:t.id}),a())},className:"w-full",children:[i.jsx(m.Z,{className:"mr-2 h-4 w-4"}),"Aceptar y Crear Compromiso"]})})[e.status]||null}function F({tx:e,onAction:a}){let{currentUser:t}=(0,d.a)(),l=(0,s.useRouter)(),[r,c]=(0,n.useState)(0),[m,b]=(0,n.useState)(""),[u,p]=(0,n.useState)(!1);if(!t)return null;let f=async()=>{0!==r&&t&&(await (0,z.hD)({transactionId:e.id,userId:t.id,rating:r,comment:m}),p(!1),a(),l.push(`/payment?commitmentId=${e.id}`))};return u?(0,i.jsxs)("div",{className:"py-6 space-y-6",children:[i.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3,4,5].map(e=>i.jsx(x.Z,{className:`w-8 h-8 cursor-pointer ${r>=e?"text-yellow-400 fill-yellow-400":"text-gray-300"}`,onClick:()=>c(e)},e))}),i.jsx(P.g,{placeholder:"A\xf1ade un comentario opcional...",value:m,onChange:e=>b(e.target.value),rows:4}),(0,i.jsxs)("div",{className:"flex justify-end gap-2",children:[i.jsx(o.z,{variant:"outline",onClick:()=>p(!1),children:"Atr\xe1s"}),i.jsx(o.z,{onClick:f,disabled:0===r,children:"Continuar al Pago"})]})]}):({"Pendiente de Confirmaci\xf3n del Cliente":i.jsx(o.z,{onClick:()=>p(!0),className:"w-full",children:"Confirmar Recepci\xf3n y Calificar"}),"Finalizado - Pendiente de Pago":(0,i.jsxs)(o.z,{onClick:()=>l.push(`/payment?commitmentId=${e.id}`),className:"w-full",children:[i.jsx(h.Z,{className:"mr-2 h-4 w-4"}),"Pagar Ahora"]}),"Cotizaci\xf3n Recibida":(0,i.jsxs)(o.z,{onClick:()=>l.push(`/payment?commitmentId=${e.id}`),className:"w-full",children:[i.jsx(h.Z,{className:"mr-2 h-4 w-4"}),"Pagar Ahora"]})})[e.status]||null}function A({transaction:e,isOpen:a,onOpenChange:t}){let{currentUser:s,users:x}=(0,d.a)(),[w,P]=(0,n.useState)(null),[S,$]=(0,n.useState)(!1);if(!e||!s)return null;let D=()=>t(!1),A="provider"===s.type,E="client"===s.type,T="Sistema"===e.type,B=T&&e.details.isRenewable,q={"Solicitud Pendiente":{icon:b.Z,color:"bg-yellow-500"},"Cotizaci\xf3n Recibida":{icon:u.Z,color:"bg-blue-500"},"Cita Solicitada":{icon:m.Z,color:"bg-orange-500"},"Servicio en Curso":{icon:p.Z,color:"bg-green-500"},"En Disputa":{icon:f.Z,color:"bg-red-500"},Pagado:{icon:g.Z,color:"bg-green-500"},"Carrito Activo":{icon:j.Z,color:"bg-gray-500"},"Pre-factura Pendiente":{icon:j.Z,color:"bg-gray-500"},"Acuerdo Aceptado - Pendiente de Ejecuci\xf3n":{icon:p.Z,color:"bg-cyan-500"},"Finalizado - Pendiente de Pago":{icon:c.Z,color:"bg-orange-500"},"Pendiente de Confirmaci\xf3n del Cliente":{icon:c.Z,color:"bg-yellow-600"},"Pago Enviado - Esperando Confirmaci\xf3n":{icon:h.Z,color:"bg-blue-500"},"Buscando Repartidor":{icon:v.Z,color:"bg-yellow-500"},"En Reparto":{icon:v.Z,color:"bg-blue-500"},Resuelto:{icon:g.Z,color:"bg-green-500"},"Error de Delivery - Acci\xf3n Requerida":{icon:j.Z,color:"bg-red-500"}},L=q[e.status]?.icon||j.Z,M=q[e.status]?.color||"bg-gray-500";return(0,i.jsxs)(i.Fragment,{children:[i.jsx(Z.aR,{open:S,onOpenChange:$,children:(0,i.jsxs)(Z._T,{children:[(0,i.jsxs)(Z.fY,{children:[i.jsx(Z.f$,{children:"No se encontr\xf3 un repartidor"}),i.jsx(Z.yT,{children:"Elige una opci\xf3n para continuar."})]}),(0,i.jsxs)("div",{className:"flex flex-col gap-4 py-4",children:[(0,i.jsxs)(o.z,{onClick:()=>{e&&((0,k.nt)({transactionId:e.id}),D())},children:[i.jsx(y.Z,{className:"mr-2 h-4 w-4"}),"Volver a Intentar B\xfasqueda"]}),(0,i.jsxs)(o.z,{onClick:()=>{e&&s&&((0,k.Ql)(e.id,s.id),D())},variant:"outline",children:[i.jsx(v.Z,{className:"mr-2 h-4 w-4"}),"Asignarme el Delivery"]}),(0,i.jsxs)(o.z,{onClick:()=>{e&&((0,k.jY)({transactionId:e.id}),D())},variant:"secondary",children:[i.jsx(p.Z,{className:"mr-2 h-4 w-4"}),"Convertir a Retiro en Tienda"]})]}),i.jsx(Z.xo,{children:i.jsx(Z.le,{children:"Cerrar"})})]})}),i.jsx(l.Vq,{open:a&&!S,onOpenChange:D,children:(0,i.jsxs)(l.cZ,{className:"sm:max-w-lg",children:[(0,i.jsxs)(l.fK,{children:[(0,i.jsxs)(l.$N,{className:"flex items-center gap-3",children:[i.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${M}`,children:i.jsx(L,{className:"w-5 h-5 text-white"})}),"Detalles de la Transacci\xf3n"]}),(0,i.jsxs)(l.Be,{children:["ID: ",e.id]})]}),(0,i.jsxs)("div",{className:"grid gap-4 py-4 text-sm",children:[(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,i.jsxs)("div",{children:[i.jsx("span",{className:"font-semibold",children:"Estado:"})," ",i.jsx(r.C,{variant:"secondary",children:e.status})]}),(0,i.jsxs)("div",{children:[i.jsx("span",{className:"font-semibold",children:"Fecha:"})," ",new Date(e.date).toLocaleDateString()]}),(0,i.jsxs)("div",{children:[i.jsx("span",{className:"font-semibold",children:"Tipo:"})," ",e.type]}),e.details.baseAmount?(0,i.jsxs)("div",{className:"col-span-2 space-y-1 mt-2 p-2 border-t",children:[(0,i.jsxs)("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Subtotal:"})," ",(0,i.jsxs)("span",{className:"font-mono",children:["Bs. ",e.details.baseAmount.toFixed(2)]})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsxs)("span",{children:["Comisi\xf3n (",100*(e.details.commissionRate||0),"%):"]})," ",(0,i.jsxs)("span",{className:"font-mono",children:["Bs. ",e.details.commission?.toFixed(2)||"0.00"]})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsxs)("span",{children:["IVA (",100*(e.details.taxRate||0),"%):"]})," ",(0,i.jsxs)("span",{className:"font-mono",children:["Bs. ",e.details.tax?.toFixed(2)||"0.00"]})]}),(0,i.jsxs)("div",{className:"flex justify-between font-bold",children:[i.jsx("span",{children:"Total Factura:"})," ",(0,i.jsxs)("span",{className:"font-mono",children:["Bs. ",e.amount.toFixed(2)]})]}),(0,i.jsxs)("div",{className:"text-xs text-muted-foreground text-right",children:["Tasa de cambio: Bs. ",e.details.exchangeRate?.toFixed(2)," / USD"]})]}):(0,i.jsxs)("div",{children:[i.jsx("span",{className:"font-semibold",children:"Monto:"})," $",e.amount.toFixed(2)]}),(0,i.jsxs)("div",{children:[i.jsx("span",{className:"font-semibold",children:"Cliente:"})," ",E?"T\xfa":w?.name]}),(0,i.jsxs)("div",{children:[i.jsx("span",{className:"font-semibold",children:"Proveedor:"})," ",A?"T\xfa":w?.name||"Sistema"]}),e.details.paymentFromThirdParty&&i.jsx("div",{className:"col-span-2",children:(0,i.jsxs)(r.C,{variant:"destructive",children:[i.jsx(j.Z,{className:"mr-1 h-3 w-3"}),"Pago recibido de un tercero"]})})]}),i.jsx("hr",{}),A?i.jsx(R,{tx:e,onAction:D}):E?i.jsx(F,{tx:e,onAction:D}):null]}),(0,i.jsxs)(l.cN,{className:"flex-wrap sm:justify-between gap-2 pt-4 border-t",children:[(0,i.jsxs)("div",{className:"flex gap-2",children:[!T&&(0,i.jsxs)(o.z,{variant:"outline",onClick:()=>(0,z.vH)(e.id),disabled:"En Disputa"===e.status,children:[i.jsx(f.Z,{className:"mr-2 h-4 w-4"})," Disputa"]}),B&&(0,i.jsxs)(o.z,{variant:"destructive",onClick:()=>(0,z.ec)(e.id),children:[i.jsx(C.Z,{className:"mr-2 h-4 w-4"})," Cancelar Renovaci\xf3n"]}),"Pagado"===e.status&&(0,i.jsxs)(o.z,{variant:"outline",onClick:()=>I([e]),children:[i.jsx(N.Z,{className:"mr-2 h-4 w-4"})," PDF"]})]}),i.jsx(l.GG,{asChild:!0,children:i.jsx(o.z,{variant:"secondary",children:"Cerrar"})})]})]})})]})}},76897:(e,a,t)=>{t.d(a,{Pz:()=>s,Ql:()=>n,e5:()=>l,jY:()=>r,nt:()=>o}),t(15424);var i=t(46242),n=(0,i.$)("6f4fd6fdabfafb35d4de90c6c9f78daac42fdb0b");(0,i.$)("1de1b9f86f7a994eadec21ebf86eec4102a17987");var s=(0,i.$)("ac0ea4208717bfc613e9025d88ba6aaded750086"),l=(0,i.$)("9474bc947e5f04b96d7e3e85586064a49fa1ba39"),o=(0,i.$)("7edf0eccac857ad0203221242ddd102790570a06"),r=(0,i.$)("60bff9d42aaa498b8b66134d44b8a07bf56199c0")},70067:(e,a,t)=>{t.a(e,async(e,i)=>{try{t.r(a),t.d(a,{acceptDeliveryJob:()=>m,assignOwnDelivery:()=>u,completeDelivery:()=>x,getDeliveryJobs:()=>c,resolveDeliveryAsPickup:()=>b,retryFindDelivery:()=>h});var n=t(27745);t(26461);var s=t(30207),l=t(20147),o=t(30266),r=t(85723),d=e([l,o]);async function c(e){let a=(0,o.hi)().collection("transactions").where("status","==","Buscando Repartidor"),t=await a.get();return t.empty?[]:t.docs.map(e=>e.data())}async function m(e,a){let t=(0,o.hi)();await (0,l.aD)(t,{transactionId:e,providerId:a}),(0,s.revalidatePath)("/delivery/dashboard")}async function x(e){let a=(0,o.hi)();await (0,l.UQ)(a,{transactionId:e}),(0,s.revalidatePath)("/delivery/dashboard")}async function h(e){let a=(0,o.hi)();(0,l.w2)(a,{transactionId:e.transactionId}),(0,s.revalidatePath)("/transactions")}async function b(e){let a=(0,o.hi)();await (0,l.Cg)(a,e),(0,s.revalidatePath)("/transactions")}async function u(e,a){let t=(0,o.hi)().collection("transactions").doc(e);await t.update({"details.deliveryProviderId":a,status:"En Reparto"}),(0,s.revalidatePath)("/transactions")}[l,o]=d.then?(await d)():d,(0,r.h)([c,m,x,h,b,u]),(0,n.j)("1de1b9f86f7a994eadec21ebf86eec4102a17987",c),(0,n.j)("ac0ea4208717bfc613e9025d88ba6aaded750086",m),(0,n.j)("9474bc947e5f04b96d7e3e85586064a49fa1ba39",x),(0,n.j)("7edf0eccac857ad0203221242ddd102790570a06",h),(0,n.j)("60bff9d42aaa498b8b66134d44b8a07bf56199c0",b),(0,n.j)("6f4fd6fdabfafb35d4de90c6c9f78daac42fdb0b",u),i()}catch(e){i(e)}})}};